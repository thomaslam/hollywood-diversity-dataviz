<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>D3: Using D3 to change fill color on mouseover</title>
	<script type="text/javascript" src="../d3.js"></script>
	<style type="text/css">
		/* No style rules here yet */
	</style>
</head>

<body>
	<script type="text/javascript">
		var dataset = []
		d3.csv("../data/movie_merged.csv", function (d) {
			return {
				year: d['title_year'],
				male: d['num_males'],
				female: d['num_females']
			}
		}, function (error, rows) {
			dataset = d3.nest().
			key(function (d) {
				return d.year;
			}).rollup(function (v) {
				return {
					males: d3.sum(v, function (d) {
						return d.male;
					}),
					females: d3.sum(v, function (d) {
						return d.female;
					})
				}
			}).entries(rows);
			dataset = dataset.map(element => {
				if (element.key && element.key.length) return {
					year: element.key,
					maleratio: element.value.males / (element.value.males + element.value.females) * 100,
					femaleratio: element.value.females / (element.value.males + element.value.females) *
						100
				}
			});
			dataset = dataset.filter(element => element != null);
			dataset.sort(function (a, b) {
				return a.year - b.year
			})
			console.log(dataset);
			var parseTime = d3.timeParse("%Y");
			var svgWidth = 600,
				svgHeight = 400;
			var margin = {
				top: 40,
				right: 20,
				bottom: 40,
				left: 70
			};
			var width = svgWidth - margin.left - margin.right;
			var height = svgHeight - margin.top - margin.bottom;
			//Create SVG element
			var svg = d3.select("body")
				.append("svg")
				.attr("width", svgWidth)
				.attr("height", svgHeight);

			//Create scale functions
			xScale = d3.scaleTime()
				.domain([
					d3.min(dataset, function (d) {
						return parseTime(Math.round(d.year));
					}),
					d3.max(dataset, function (d) {
						return parseTime(Math.round(d.year));
					})
				])
				.range([margin.left, margin.left + width]);

			yScale = d3.scaleLinear()
				.domain([0, 100])
				.range([svgHeight - margin.bottom, margin.top]);
			//Define X axis
			xAxis = d3.axisBottom()
				.scale(xScale)
				.ticks(5);

			//Define Y axis
			yAxis = d3.axisLeft()
				.scale(yScale)
				.ticks(5);
			//Create X axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (svgHeight - margin.bottom) + ")")
				.call(xAxis);

			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + margin.left + "," + 0 + ")")
				.call(yAxis);
			var valueline = d3.line()
				.x(function (d) {
					return xScale(parseTime(Math.round(d.year)));
				})
				.y(function (d) {
					return yScale(d.maleratio);
				});
				var valueline2 = d3.line()
				.x(function (d) {
					return xScale(parseTime(Math.round(d.year)));
				})
				.y(function (d) {
					return yScale(d.femaleratio);
				});
			svg.append("path")
				.attr("class", "line")
				.attr("d", valueline(dataset))
				.attr("stroke", "blue")
				.attr("stroke-width", 2)
				.attr("fill", "none");
				svg.append("path")
				.attr("class", "line")
				.attr("d", valueline2(dataset))
				.attr("stroke", "red")
				.attr("stroke-width", 2)
				.attr("fill", "none");
				
		});
	</script>
</body>

</html>